#
# Copyright (c) 2019-2020, University of Southampton and Contributors.
# All rights reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

# Fused configuration parameters.
# Note that command line options take precedence over config-file options, so
# any options specified here may be overruled when launching Fused.

# Board
Board: MemicBoard

# ------ Paths ------
OutputDirectory: /tmp/fused-outputs
BootTracePath: none
VccMultiplierPath: none

# Operation mode/Program to execute:
GdbServer: True # Will use gdb server to control mcu if true, loads ProgramHexFile otherwise
ProgramHexFile: none # Path to a program hex file

Bme280TraceFile: none
AccelerometerTraceFile: none

# ------ Simulation control ------
SimTimeLimit: 300.0 # Simulation time limit (seconds)
IoSimulationStopperTarget: 3000 # Simulation stops after X posedge of pin connected to simstopper

# ------ Timesteps ------
PowerModelTimestep: 10.0E-6
LogTimestep: 1.0e-3  # Time step of the power model's csv files

# ------ Cortex M0 Clocks ------
MasterClockPeriod: 800.0e-9
PeripheralClockPeriod: 800.0e-9

# ------ CPU version ------
CortexM0Version: cm0+

# ------ Power supply ------
PowerSupplyVoltage: 1.81 #[W]
PowerSupplyPower: 10.0E-6 #[W]
SupplyCurrentLimit: 5.0E-3 #[A]
SupplyVoltageLimit: 3.59 # [V]

# ------ Power system ------
CpuCoreVoltage: 1.8 #[V]
# Supply voltage supervisor
SVSVon: 2.6 #[V]
SVSVoff: 2.4 #[V]
VoltageWarning: 2.1 # [V]

# Storage capacitor
CapacitorValue: 10.0e-6 # [F]
CapacitorInitialVoltage: 2.5 # [V]

# ------ MemicBoard-specific settings ------
MemicBoard.mcu.icache.Enable: True
MemicBoard.mcu.icache.CacheReplacementPolicy: PseudoRandom
MemicBoard.mcu.icache.CacheWritePolicy: WriteThrough # {WriteThrough, WriteAround, WriteBack}
MemicBoard.mcu.icache.CacheLineWidth: 16
MemicBoard.mcu.icache.CacheNLines: 2
MemicBoard.mcu.icache.CacheNSets: 128
MemicBoard.mcu.icache.icache_ctrl.MaxModified: 128

MemicBoard.mcu.dcache.Enable: True
MemicBoard.mcu.dcache.CacheReplacementPolicy: PseudoRandomNotDirty
MemicBoard.mcu.dcache.CacheWritePolicy: WriteBack # {WriteThrough, WriteAround, WriteBack}
MemicBoard.mcu.dcache.CacheLineWidth: 32
MemicBoard.mcu.dcache.CacheNLines: 2
MemicBoard.mcu.dcache.CacheNSets: 32
MemicBoard.mcu.dcache.dcache_ctrl.MaxModified: 128

# UndoLogger log capacity (cache lines)
MemicBoard.mcu.undoLogger.capacity: 8

# Power consumption of states (in this case current (A))

# MRAM 0.44 pJ read / 12 pJ write per bit
# MRAM 5.8 pJ read / 67.9 pJ write per bit
MemicBoard.mcu.invm on: 0.0
MemicBoard.mcu.invm off: 0.0
MemicBoard.mcu.invm bytes read: 0.0
MemicBoard.mcu.invm bytes written: 0.0
MemicBoard.mcu.invm write: 2.172e-9
MemicBoard.mcu.invm read: 1.869e-10
MemicBoard.mcu.invm retentionToActive: 368.0e-12
MemicBoard.mcu.invm activeToRetention: 1.99e-11

MemicBoard.mcu.dnvm on: 0.0
MemicBoard.mcu.dnvm off: 0.0
MemicBoard.mcu.dnvm bytes read: 0.0
MemicBoard.mcu.dnvm bytes written: 0.0
MemicBoard.mcu.dnvm write: 2.172e-9
MemicBoard.mcu.dnvm read: 1.869e-10
MemicBoard.mcu.dnvm retentionToActive: 368.0e-12
MemicBoard.mcu.dnvm activeToRetention: 1.99e-11

# Instruction SRAM 0.66 pJ read/write per bit
MemicBoard.mcu.isram on: 0.0
MemicBoard.mcu.isram off: 0.0
MemicBoard.mcu.isram bytes read: 0.0
MemicBoard.mcu.isram bytes written: 0.0
MemicBoard.mcu.isram write:  1.05e-11 #3.84e-12
MemicBoard.mcu.isram read: 1.05e-11 #2.112e-11 # 3.84e-12
MemicBoard.mcu.isram retentionToActive: 9.40e-11
MemicBoard.mcu.isram activeToRetention: 1.76e-12

# Data SRAM 0.12pJ read/write per bit
MemicBoard.mcu.dsram on: 0.0
MemicBoard.mcu.dsram off: 0.0
MemicBoard.mcu.dsram bytes read: 0.0
MemicBoard.mcu.dsram bytes written: 0.0
MemicBoard.mcu.dsram write: 1.05e-11 #2.112e-11 # 3.84e-12
MemicBoard.mcu.dsram read: 1.05e-11 #2.112e-11 # 3.84e-12
MemicBoard.mcu.dsram retentionToActive: 9.40e-11
MemicBoard.mcu.dsram activeToRetention: 1.76e-12

# Cache (same energy as sram)
MemicBoard.mcu.icache on: 5.295e-11 #5.531e-11 #A per bit
MemicBoard.mcu.icache off: 0.0
MemicBoard.mcu.icache bytes read: 2.64e-12 #9.6e-13
MemicBoard.mcu.icache bytes written: 2.64e-12 #9.6e-13
MemicBoard.mcu.icache tag read bits: 0.66e-12
MemicBoard.mcu.icache tag write bits: 0.66e-12

MemicBoard.mcu.dcache on: 5.295e-11 #5.531e-11 #A per bit
MemicBoard.mcu.dcache off: 0.0
MemicBoard.mcu.dcache bytes read: 2.64e-12 #9.6e-13
MemicBoard.mcu.dcache bytes written: 2.64e-12 #9.6e-13
MemicBoard.mcu.dcache tag read bits: 3.3e-13 # 0.12e-12
MemicBoard.mcu.dcache tag write bits: 3.3e-13 # 0.12e-12

# Undo log internal buffer (same energy as sram)
MemicBoard.mcu.undoLogger read log byte: 3.3e-13 #9.6e-13
MemicBoard.mcu.undoLogger write log byte: 3.3e-13 #9.6e-13

# CPU current
MemicBoard.mcu.CPU on:  1.0e-6 # CM0 active current
MemicBoard.mcu.CPU off:  0.0
MemicBoard.mcu.CPU sleep:  0.0

# Banked Memory settings
MemicBoard.mcu.isram.Enable: False
MemicBoard.mcu.isram.AutoRetentionDelayCycles: 1000
MemicBoard.mcu.isram.ActiveToRetentionDelayCycles: 1
MemicBoard.mcu.isram.RetentionToActiveDelayCycles: 1

MemicBoard.mcu.dsram.Enable: False
MemicBoard.mcu.dsram.AutoRetentionDelayCycles: 1000
MemicBoard.mcu.dsram.ActiveToRetentionDelayCycles: 1
MemicBoard.mcu.dsram.RetentionToActiveDelayCycles: 1

MemicBoard.mcu.invm.AutoRetentionDelayCycles: 1000
MemicBoard.mcu.invm.ActiveToRetentionDelayCycles: 7
MemicBoard.mcu.invm.RetentionToActiveDelayCycles: 7

MemicBoard.mcu.dnvm.AutoRetentionDelayCycles: 1000
MemicBoard.mcu.dnvm.ActiveToRetentionDelayCycles: 7
MemicBoard.mcu.dnvm.RetentionToActiveDelayCycles: 7

# Banked Memory static power
MemicBoard.mcu.isram.active: 5.295e-11 #5.531e-11 #A per bit
MemicBoard.mcu.isram.retention: 1.12e-11 #A per bit
MemicBoard.mcu.isram.off: 0.0 #A per bit

MemicBoard.mcu.dsram.active: 5.295e-11 #5.531e-11 #A per bit
MemicBoard.mcu.dsram.retention: 1.12e-11 #A per bit
MemicBoard.mcu.dsram.off: 0.0 #A per bit

MemicBoard.mcu.invm.active: 1.11527e-10 #A per bit
MemicBoard.mcu.invm.retention: 7.70e-13 #A per bit
MemicBoard.mcu.invm.off: 0.0 #A per bit

MemicBoard.mcu.dnvm.active: 1.11527e-10 #A per bit
MemicBoard.mcu.dnvm.retention: 7.70e-13 #A per bit
MemicBoard.mcu.dnvm.off: 0.0 #A per bit

# ------ Peripheral settings ------

# BME280 temperature/humidity/pressure sensor power consumption (state-based)
BME280 off:  0.0
BME280 sleep: 0.1e-6
BME280 standby: 0.2e-6
BME280 measure_humidity: 340.0e-6
BME280 measure_pressure:  714.0e-6
BME280 measure_temperature: 350.0e-6

# Accelerometer (event- & state-based)
Accelerometer active: 500.0e-9 # Active/standby current [A] (~ Low-power mode from datasheet)
#Accelerometer sleep: 160.0e-9 # Sleep current [A] (Sleep mode from datasheet)
Accelerometer sleep: 0.0
# Energy per sample: 1.8V * (3.5µA) / 800Hz (Normal mode, OSR=0 from datasheet)
Accelerometer sample: 7.875e-9 # Energy per sample [J]

